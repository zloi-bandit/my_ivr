<!DOCTYPE html>
<html>
<head>
<script src="jquery-3.0.0.js"></script>
<script>

function addNewElement() {;

var rows_quantity=document.getElementsByClassName("tablerow").length;
var rows_quantity_next=rows_quantity + 1;
var last_element_id = "tablerow" + rows_quantity;

var ivr_input_table_row1 = "<table style=\"width:100%\" class=\"tablerow\" id=\"tablerow" + rows_quantity_next; 

var ivr_input_table_row2 = "\"><tr><td><select id=\"trig" + rows_quantity_next + "\" class=\"trig";

var ivr_input_table_row3 = "\"><option value=\"press_button\">Press Button</option><option value=\"no_input\">No Input</option><option value=\"invalid_input\">Invalid Input</option> </select> </td><td><input type=\"text\" name=\"number_input" + rows_quantity_next;

var ivr_input_table_row4 = "\"></td>  <td id=\"123\"><select id=\"act" + rows_quantity_next;
var ivr_input_table_row5 = "\"></select></td> <td> </td> </tr>    </table>";


var ivr_input_table_row = ivr_input_table_row1 + ivr_input_table_row2 + ivr_input_table_row3 + ivr_input_table_row4 + ivr_input_table_row5;

$(".tablerow:last").after(ivr_input_table_row); 


$(".trig").change ( function () { 

var action_trig=$(this, "option:selected").val(); 
var this_element = this;
var re = /[0-9]+/g;
var re_array = re.exec(this.id); 
var act_id = "act" + re_array[0];
var act = document.getElementById(act_id);

	if (action_trig == "no_input" || action_trig == "invalid_input"){ 
	$(act).html('<option>- Нет опций -</option>'); $(act).attr("disabled", true); return(false); 
	} 

 	if (action_trig == "press_button"){ 

		$.get("3.php", "web_action_name=web_action_name", function (result) { 
	
			if (result.type == 'error'){  
			return(false); 
			}
 
		var options = ''; 
	
			$(result.web_action_name).each( function(){ 
			options += "<option value=\"" + $(this).attr("id") + "\">" + $(this).attr("title") + "</option>"; 
			});
 
		$(act).html(options); 
		$(act).attr("disabled", false); 	

		}, "json" ); 
	} 
}); 

$(".trig").trigger('change'); 

} 

function LoadSelectWithActions() {

	select_id = "action_select";;
 
		$.get("4.php", '', function (result) {

	 		if (result.type == 'error'){
                        return(false);
                        }

                var options = '';

                        $(result.select_id).each( function(){
                        options += "<option value=\"" + $(this).attr("id") + "\">" + $(this).attr("title") + "</option>";
                        });

		var select_jquery_id = "#" + select_id;

                $(select_jquery_id).html(options);
                $(select_jquery_id).attr("disabled", false);

                }, "json" );	
}	


</script>

<style>
 table {
        font-family: arial, sans-serif;
        border-collapse: collapse; 
        width: 100%;
 }

 td, th {
        border: 1px solid #dddddd;
        text-align:left;
        padding: 8px;
 }

 tr:nth-child(even) {
        background-color: #dddddd;
 }

</style> 


</head>
<body onload="LoadSelectWithActions()">

<h1>Действия для данного меню</h1>

<select id="action_select" on></select>

<button onclick="addNewAction()">Добавить действие</button>


<h1>Меню IVR</h1>
<table style="width:100%" class="tablerow" id="tablerow1"><tr> <th>Триггер</th>  <th>Значение</th>  <th>Действие</th> <th>Аргумент</th> </tr> </table>

<button onclick="addNewElement()">Добавить</button>

</body>
</html>

